name: Deploy

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - run: echo "building..."
      - run: echo "build artifact" > build.txt
      - uses: actions/upload-artifact@v4
        with:
          name: build-artifact
          path: build.txt

  test-unit:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: echo "unit tests..."

  test-integration:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: echo "integration tests..."

  deploy-staging:
    needs: [test-unit, test-integration]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: build-artifact
      - run: echo "deploying to staging..."
      - run: cat build.txt

  deploy-production:
    needs: deploy-staging
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v4
        with:
          name: build-artifact
      - run: echo "deploying to production..."
      - run: cat build.txt 